<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIPP Antioch Global Campus - Reservation Calendar</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Work+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2C5F2D;
            --primary-light: #97BC62;
            --accent: #FF6B35;
            --bg-main: #FAF9F6;
            --bg-card: #FFFFFF;
            --text-dark: #1A1A1A;
            --text-mid: #4A4A4A;
            --text-light: #8A8A8A;
            --border: #E0DDD8;
            --shadow: rgba(44, 95, 45, 0.08);
            --shadow-hover: rgba(44, 95, 45, 0.15);
            --success: #28A745;
            --danger: #DC3545;
            --warning: #FFC107;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* Touch-friendly improvements */
        button, .btn, .tab, .location-card, .calendar-day, .time-slot {
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
            touch-action: manipulation;
        }
        
        /* Prevent text selection on double-tap */
        .calendar-day, .time-slot, .location-card, .btn, .tab {
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* Allow text selection in form inputs */
        input, textarea, select {
            -webkit-user-select: text;
            user-select: text;
        }
        
        body {
            font-family: 'Work Sans', sans-serif;
            background: linear-gradient(135deg, #FAF9F6 0%, #F0EDE5 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        h1, h2, h3 { font-family: 'Crimson Pro', serif; font-weight: 700; }
        
        #root { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #b9d3e7 0%, #d4e5f3 100%);
            border-radius: 20px;
            margin-bottom: 40px;
            box-shadow: 0 10px 40px var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            border-radius: 50%;
        }
        
        .header h1 {
            color: #17345b;
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.3);
        }
        
        .header p { color: #17345b; font-size: 1.1em; position: relative; }
        
        .nav-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--border);
            padding-bottom: 0;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            padding: 15px 30px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-family: 'Work Sans', sans-serif;
            font-size: 1em;
            font-weight: 500;
            color: var(--text-mid);
            transition: all 0.3s ease;
        }
        
        .nav-tab:hover { color: var(--primary); background: rgba(44, 95, 45, 0.05); }
        .nav-tab.active { color: var(--primary); border-bottom-color: var(--accent); font-weight: 600; }
        
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px var(--shadow);
            margin-bottom: 25px;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
        }
        
        .card h2 { color: var(--primary); margin-bottom: 20px; font-size: 1.8em; }
        
        .login-container {
            max-width: 500px;
            margin: 0 auto;
            text-align: center;
            padding: 40px;
        }
        
        .login-container h2 { margin-bottom: 15px; }
        .login-container p { color: var(--text-mid); margin-bottom: 30px; }
        
        .login-form { display: flex; flex-direction: column; gap: 20px; }
        
        .admin-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .admin-email { font-weight: 600; font-size: 1.1em; }
        
        .logout-btn {
            padding: 8px 16px;
            background: white;
            color: var(--primary);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover { background: rgba(255,255,255,0.9); transform: translateY(-2px); }
        
        .location-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .location-card {
            padding: 25px;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #FFFFFF 0%, #F8F8F8 100%);
            text-align: center;
        }
        
        .location-card:hover {
            border-color: var(--primary-light);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px var(--shadow-hover);
        }
        
        .location-card h3 { font-size: 1.3em; margin-bottom: 5px; }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 12px;
            color: white;
        }
        
        .calendar-header h3 { font-size: 1.8em; }
        .calendar-nav { display: flex; gap: 15px; }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Work Sans', sans-serif;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover:not(:disabled) { background: #E55A2B; }
        
        .btn-secondary { background: white; color: var(--primary); border: 2px solid var(--primary); }
        .btn-secondary:hover:not(:disabled) { background: var(--primary); color: white; }
        
        .btn-success { background: var(--success); color: white; }
        .btn-success:hover:not(:disabled) { background: #218838; }
        
        .btn-danger { background: var(--danger); color: white; }
        .btn-danger:hover:not(:disabled) { background: #C82333; }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            padding: 12px;
            color: var(--primary);
            background: rgba(44, 95, 45, 0.05);
            border-radius: 8px;
            font-size: 0.9em;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            background: white;
            position: relative;
            min-height: 90px;
            font-size: 1em;
        }

        .calendar-day::-webkit-scrollbar {
            display: none;
        }
        
        .calendar-day:hover:not(.disabled):not(.other-month) {
            border-color: var(--primary-light);
            background: rgba(151, 188, 98, 0.1);
            transform: scale(1.05);
        }
        
        .calendar-day.selected {
            background: linear-gradient(135deg, #17345b 0%, #255694 100%);
            color: white;
            border-color: #17345b;
            font-weight: 600;
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(23, 52, 91, 0.4);
        }
        
        .calendar-day.disabled { color: var(--text-light); cursor: not-allowed; opacity: 0.4; }
        .calendar-day.other-month { color: var(--text-light); opacity: 0.3; }
        
        .calendar-day.has-reservation::after {
            display: none; /* Using background colors instead of dots */
        }
        
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }
        
        .time-slot {
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            background: white;
        }
        
        .time-slot:hover:not(.disabled) {
            border-color: var(--primary-light);
            background: rgba(151, 188, 98, 0.1);
            transform: translateY(-2px);
        }
        
        .time-slot.selected { background: var(--primary); color: white; border-color: var(--primary); }
        .time-slot.disabled { opacity: 0.3; cursor: not-allowed; }
        .time-slot.booked-range { 
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
            color: white;
            border-color: var(--primary);
            font-weight: 600;
        }
        
        .form-group { margin-bottom: 20px; }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-dark);
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: 'Work Sans', sans-serif;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(44, 95, 45, 0.1);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .reservation-list { display: flex; flex-direction: column; gap: 15px; }
        
        .reservation-item {
            padding: 25px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: white;
            transition: all 0.3s ease;
        }
        
        .reservation-item:hover { box-shadow: 0 4px 15px var(--shadow); }
        
        .reservation-item.status-pending { border-left: 5px solid var(--warning); }
        .reservation-item.status-approved { border-left: 5px solid var(--success); }
        .reservation-item.status-denied { border-left: 5px solid var(--danger); }
        
        .reservation-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .reservation-title {
            font-weight: 600;
            font-size: 1.3em;
            color: var(--primary);
            font-family: 'Crimson Pro', serif;
        }
        
        .reservation-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-pending { background: #FFF3CD; color: #856404; }
        .status-approved { background: #D4EDDA; color: #155724; }
        .status-denied { background: #F8D7DA; color: #721C24; }
        
        .reservation-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
            color: var(--text-mid);
            overflow-wrap: break-word;
        }
        
        .reservation-detail-item { 
            display: flex; 
            flex-direction: column;
            word-wrap: break-word;
            overflow-wrap: break-word;
            min-width: 0;
        }
        
        .reservation-detail-label {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.9em;
        }
        
        .reservation-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            padding: 25px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px var(--shadow);
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            font-family: 'Crimson Pro', serif;
        }
        
        .stat-label { font-size: 0.9em; opacity: 0.9; text-transform: uppercase; }
        
        .success-message {
            background: linear-gradient(135deg, #D4EDDA 0%, #C3E6CB 100%);
            color: #155724;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 5px solid #28A745;
            font-weight: 500;
        }
        
        .error-message {
            padding: 15px;
            background: #F8D7DA;
            color: #721C24;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #F5C6CB;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: var(--bg-card);
            padding: 40px;
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }
        
        .modal-header h2 { margin: 0; }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: var(--text-mid);
            transition: all 0.3s ease;
        }
        
        .filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            padding: 20px;
            background: rgba(44, 95, 45, 0.05);
            border-radius: 12px;
        }
        
        .filter-bar select {
            padding: 10px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: white;
            font-family: 'Work Sans', sans-serif;
        }
        
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .container { 
                padding: 10px; 
                max-width: 100%;
            }
            
            .header { 
                padding: 20px 15px;
                margin-bottom: 20px;
                border-radius: 12px;
            }
            
            .header h1 { 
                font-size: 1.5em;
                line-height: 1.3;
            }
            
            .header p {
                font-size: 0.9em;
                line-height: 1.5;
            }
            
            .tabs {
                flex-direction: column;
                gap: 10px;
            }
            
            .tab {
                width: 100%;
                padding: 12px;
                font-size: 0.95em;
            }
            
            .card {
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .card h2 {
                font-size: 1.3em;
            }
            
            /* Admin Login Form - Mobile Optimized */
            .card form {
                max-width: 100%;
            }
            
            .card form input[type="email"],
            .card form input[type="password"] {
                width: 100%;
                font-size: 16px; /* Prevents iOS zoom */
                padding: 12px;
                margin-bottom: 15px;
            }
            
            .card form button[type="submit"] {
                width: 100%;
                padding: 14px;
                font-size: 1em;
            }
            
            /* Admin Panel - Mobile Optimized */
            .admin-card {
                padding: 12px;
                margin-bottom: 15px;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
            
            .admin-card h3 {
                font-size: 0.95em;
                margin-bottom: 8px;
                word-break: break-word;
            }
            
            .admin-card p {
                font-size: 0.85em;
                line-height: 1.4;
                margin-bottom: 6px;
                word-break: break-word;
            }
            
            .admin-actions {
                flex-wrap: wrap;
                gap: 6px;
                margin-top: 10px;
            }
            
            .admin-actions button {
                padding: 8px 12px;
                font-size: 0.8em;
                flex: 1 1 45%;
                min-width: 80px;
            }
            
            /* Ensure email addresses wrap on mobile */
            .admin-card p strong {
                word-break: break-all;
            }
            
            /* Filter buttons - mobile friendly */
            .btn-group {
                flex-direction: column;
                gap: 8px;
            }
            
            .btn-group .btn {
                width: 100%;
                padding: 10px;
                font-size: 0.9em;
            }
            
            .location-grid { 
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .location-card {
                padding: 15px;
            }
            
            .location-card h3 {
                font-size: 1.1em;
            }
            
            .calendar-grid { 
                gap: 3px;
                font-size: 0.85em;
            }
            
            .calendar-day {
                min-height: 70px;
                font-size: 0.8em;
                padding: 2px;
            }
            
            .time-slots {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .time-slot {
                padding: 10px 8px;
                font-size: 0.85em;
            }
            
            .form-grid { 
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .form-group label {
                font-size: 0.95em;
            }
            
            .form-group input,
            .form-group select,
            .form-group textarea {
                font-size: 16px; /* Prevents zoom on iOS */
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 0.95em;
                width: 100%;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .stat-card {
                padding: 12px;
            }
            
            .stat-card h3 {
                font-size: 1.2em;
            }
            
            .modal-content {
                width: 95%;
                max-height: 90vh;
                padding: 20px;
                margin: 20px auto;
            }
            
            .success-message {
                font-size: 0.9em;
                padding: 12px;
            }
        }
        
        /* Extra small mobile devices */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.3em;
            }
            
            .header p {
                font-size: 0.85em;
            }
            
            .calendar-grid {
                gap: 2px;
            }
            
            .calendar-day {
                min-height: 60px;
                font-size: 0.75em;
            }
            
            .time-slots {
                grid-template-columns: 1fr;
            }
            
            .card h2 {
                font-size: 1.2em;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Tablet landscape */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                padding: 20px;
            }
            
            .location-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .time-slots {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // GOOGLE SHEETS DATABASE CONFIGURATION
        const GOOGLE_SHEETS_API_URL = 'https://script.google.com/macros/s/AKfycbxqY3Zv8VfcFXYc0ASEgMvZ2ug0VGMZqloZlaTqhWL0AMlQodkg4TQHuPY-gmgIsKEU/exec';
        const USE_GOOGLE_SHEETS = true; // Set to false to use localStorage only

        // EMAIL CONFIGURATION - FormSubmit (100% Free, No Setup Required)
        // FormSubmit will send to these email addresses directly
        // No access key needed - just works!
        
        // Admin emails that will receive notifications
        const ADMIN_NOTIFICATION_EMAILS = [
            'christinascott@kippnashville.org',
            'grodriguez@kippnashville.org',
            'mdavis@kippnashville.org',
            'mgauthier@kippnashville.org',
            'mmarsh@kippnashville.org',
            'jessica.alexander@kippnashville.org'
        ];

        // Function to generate additional colors beyond the 6 brand colors
        const generateAdditionalColors = (count) => {
            const additionalColors = [
                '#e74c3c', '#9b59b6', '#3498db', '#1abc9c', '#f39c12', 
                '#d35400', '#c0392b', '#8e44ad', '#2980b9', '#16a085',
                '#27ae60', '#f1c40f', '#e67e22', '#e84393', '#6c5ce7',
                '#00b894', '#fdcb6e', '#d63031', '#a29bfe', '#fd79a8'
            ];
            return additionalColors.slice(0, count);
        };

        const LOCATIONS = [
            { id: 1, name: 'Global Gym', address: 'Athletic Facility', color: '#255694' },
            { id: 2, name: 'Global Soccer Field', address: 'Outdoor Field', color: '#9b59b6' },
            { id: 3, name: 'Global Cafeteria 1', address: 'Main Dining Hall', color: '#e84393' },
            { id: 4, name: 'Global Storm Shelter (Cafeteria 2)', address: 'Secondary Dining/Shelter', color: '#e74c3c' },
            { id: 5, name: 'Global Multi-Purpose Room', address: 'Activities Center', color: '#f7941e' },
            { id: 6, name: 'Global HS Family Conference Room', address: 'High School Building', color: '#b9d3e7' },
            { id: 7, name: 'Global ES/MS Family Conference Room', address: 'Elementary/Middle School Building', color: '#fcda00' },
            { id: 8, name: 'KIPP Forward', address: 'KIPP Forward Campus', color: '#638c1c' }
        ];

        const SCHOOLS = [
            'Global HS',
            'Global MS', 
            'Global ES',
            'KIPP Forward',
            'SST',
            'Other KIPP Nashville Schools',
            'Visitor'
        ];

        const TIME_SLOTS = [
            '5:00 AM', '5:30 AM', '6:00 AM', '6:30 AM', '7:00 AM', '7:30 AM',
            '8:00 AM', '8:30 AM', '9:00 AM', '9:30 AM', '10:00 AM', '10:30 AM',
            '11:00 AM', '11:30 AM', '12:00 PM', '12:30 PM', '1:00 PM', '1:30 PM',
            '2:00 PM', '2:30 PM', '3:00 PM', '3:30 PM', '4:00 PM', '4:30 PM',
            '5:00 PM', '5:30 PM', '6:00 PM', '6:30 PM', '7:00 PM', '7:30 PM',
            '8:00 PM', '8:30 PM', '9:00 PM', '9:30 PM', '10:00 PM'
        ];

        const DURATION_OPTIONS = [
            { value: 30, label: '30 minutes' }, { value: 60, label: '1 hour' },
            { value: 90, label: '1.5 hours' }, { value: 120, label: '2 hours' },
            { value: 180, label: '3 hours' }, { value: 240, label: '4 hours' },
            { value: 300, label: '5 hours' }, { value: 360, label: '6 hours' },
            { value: 420, label: '7 hours' }, { value: 480, label: '8 hours' }
        ];

        const AUTHORIZED_ADMINS = [
            'christinascott@kippnashville.org',
            'grodriguez@kippnashville.org',
            'mdavis@kippnashville.org',
            'mgauthier@kippnashville.org',
            'mmarsh@kippnashville.org',
            'jessica.alexander@kippnashville.org'
        ];

        const generateId = () => Math.random().toString(36).substr(2, 9);
        
        const formatDate = (date) => {
            return new Date(date).toLocaleDateString('en-US', { 
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
            });
        };

        const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
        const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();

        function ReservationCalendar() {
            const [activeTab, setActiveTab] = useState('calendar');
            const [selectedLocations, setSelectedLocations] = useState([]);
            const [currentDate, setCurrentDate] = useState(new Date());
            const [selectedDate, setSelectedDate] = useState(null);
            const [selectedTimeSlot, setSelectedTimeSlot] = useState(null);
            const [selectedEndTime, setSelectedEndTime] = useState(null);
            const [reservations, setReservations] = useState([]);
            const [showModal, setShowModal] = useState(false);
            const [editingReservation, setEditingReservation] = useState(null);
            const [successMessage, setSuccessMessage] = useState('');
            const [showCalendarDownload, setShowCalendarDownload] = useState(false);
            const [lastCreatedReservation, setLastCreatedReservation] = useState(null);
            const [filterStatus, setFilterStatus] = useState('all');
            const [filterLocation, setFilterLocation] = useState('all');
            const [adminEmail, setAdminEmail] = useState('');
            const [adminPassword, setAdminPassword] = useState('');
            const [isAdminAuthenticated, setIsAdminAuthenticated] = useState(false);
            const [loginError, setLoginError] = useState('');

            const calendarRef = useRef(null);
            const timeSlotsRef = useRef(null);

            const ADMIN_PASSWORD = 'Globalis#1';

            const [formData, setFormData] = useState({
                firstName: '', lastName: '', email: '', phone: '', school: '',
                numberOfPeople: 1, purpose: '', notes: '', secondaryEmail: ''
            });

            useEffect(() => {
                // Load reservations from Google Sheets
                const loadReservations = async () => {
                    if (USE_GOOGLE_SHEETS) {
                        try {
                            console.log('ðŸ“Š Loading reservations from Google Sheets...');
                            const response = await fetch(GOOGLE_SHEETS_API_URL);
                            const result = await response.json();
                            
                            if (result.success && result.data) {
                                console.log(`âœ… Loaded ${result.data.length} reservations from Google Sheets`);
                                setReservations(result.data);
                                // Also save to localStorage as backup
                                localStorage.setItem('reservations', JSON.stringify(result.data));
                            } else {
                                console.warn('âš ï¸ No data from Google Sheets, loading from localStorage backup');
                                const saved = localStorage.getItem('reservations');
                                if (saved) setReservations(JSON.parse(saved));
                            }
                        } catch (error) {
                            console.error('âŒ Error loading from Google Sheets:', error);
                            console.log('ðŸ“¦ Falling back to localStorage');
                            const saved = localStorage.getItem('reservations');
                            if (saved) setReservations(JSON.parse(saved));
                        }
                    } else {
                        // Use localStorage only
                        const saved = localStorage.getItem('reservations');
                        if (saved) setReservations(JSON.parse(saved));
                    }
                };
                
                loadReservations();
                
                const savedAdmin = localStorage.getItem('adminEmail');
                if (savedAdmin && AUTHORIZED_ADMINS.includes(savedAdmin.toLowerCase())) {
                    setAdminEmail(savedAdmin);
                    setIsAdminAuthenticated(true);
                }
            }, []);

            useEffect(() => {
                // Backup to localStorage whenever reservations change
                localStorage.setItem('reservations', JSON.stringify(reservations));
            }, [reservations]);

            useEffect(() => {
                if (selectedLocations.length > 0 && calendarRef.current) {
                    setTimeout(() => {
                        calendarRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100);
                }
            }, [selectedLocations]);

            useEffect(() => {
                if (selectedDate && timeSlotsRef.current) {
                    setTimeout(() => {
                        timeSlotsRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100);
                }
            }, [selectedDate]);

            const handleAdminLogin = (e) => {
                e.preventDefault();
                const email = adminEmail.trim().toLowerCase();
                const password = adminPassword;
                
                if (AUTHORIZED_ADMINS.includes(email) && password === ADMIN_PASSWORD) {
                    setIsAdminAuthenticated(true);
                    localStorage.setItem('adminEmail', email);
                    setLoginError('');
                    setSuccessMessage('âœ… Admin access granted!');
                    setTimeout(() => setSuccessMessage(''), 3000);
                } else {
                    setLoginError('â›” Access denied. Invalid email or password.');
                    setAdminEmail('');
                    setAdminPassword('');
                }
            };

            const handleAdminLogout = () => {
                setIsAdminAuthenticated(false);
                setAdminEmail('');
                setAdminPassword('');
                localStorage.removeItem('adminEmail');
                setActiveTab('calendar');
                setSuccessMessage('Logged out successfully');
                setTimeout(() => setSuccessMessage(''), 3000);
            };

            // Google Sheets Helper Functions
            const saveToGoogleSheets = async (reservation) => {
                if (!USE_GOOGLE_SHEETS) return true;
                
                try {
                    console.log('ðŸ’¾ Saving reservation to Google Sheets...', reservation.id);
                    const response = await fetch(GOOGLE_SHEETS_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(reservation)
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        console.log('âœ… Saved to Google Sheets successfully');
                        return true;
                    } else {
                        console.error('âŒ Failed to save to Google Sheets:', result.error);
                        return false;
                    }
                } catch (error) {
                    console.error('âŒ Error saving to Google Sheets:', error);
                    return false;
                }
            };

            const updateGoogleSheets = async (reservation) => {
                if (!USE_GOOGLE_SHEETS) return true;
                
                try {
                    console.log('ðŸ“ Updating reservation in Google Sheets...', reservation.id);
                    const response = await fetch(GOOGLE_SHEETS_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            ...reservation,
                            action: 'update'
                        })
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        console.log('âœ… Updated in Google Sheets successfully');
                        return true;
                    } else {
                        console.error('âŒ Failed to update Google Sheets:', result.error);
                        return false;
                    }
                } catch (error) {
                    console.error('âŒ Error updating Google Sheets:', error);
                    return false;
                }
            };

            const deleteFromGoogleSheets = async (reservationId) => {
                if (!USE_GOOGLE_SHEETS) return true;
                
                try {
                    console.log('ðŸ—‘ï¸ Deleting reservation from Google Sheets...', reservationId);
                    const response = await fetch(GOOGLE_SHEETS_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            id: reservationId,
                            action: 'delete'
                        })
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        console.log('âœ… Deleted from Google Sheets successfully');
                        return true;
                    } else {
                        console.error('âŒ Failed to delete from Google Sheets:', result.error);
                        return false;
                    }
                } catch (error) {
                    console.error('âŒ Error deleting from Google Sheets:', error);
                    return false;
                }
            };

            const sendEmail = async (type, reservation) => {
                console.log('ðŸ“§ Starting email send process...');
                console.log('Email type:', type);
                console.log('Reservation data:', reservation);
                
                const userEmail = reservation.email;
                const secondaryEmail = reservation.secondaryEmail;
                
                // Format the reservation details
                const reservationDetails = `
RESERVATION DETAILS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Location: ${reservation.location}
Date: ${formatDate(new Date(reservation.date))}
Start Time: ${reservation.timeSlot}
End Time: ${reservation.endTime}
Duration: ${formatDuration(reservation.duration)}

CONTACT INFORMATION:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Name: ${reservation.firstName} ${reservation.lastName}
Email: ${reservation.email}
${reservation.secondaryEmail ? `Secondary Email: ${reservation.secondaryEmail}` : ''}
Phone: ${reservation.phone}

DETAILS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
School: ${reservation.school}
Number of People: ${reservation.numberOfPeople}
Purpose: ${reservation.purpose}
${reservation.notes ? `Notes: ${reservation.notes}` : ''}
                `;

                try {
                    let subject, message;

                    // APPROVAL EMAIL
                    if (type === 'approval') {
                        subject = `âœ… Reservation APPROVED - ${reservation.location}`;
                        message = `Dear ${reservation.firstName} ${reservation.lastName},

Good news! Your reservation has been APPROVED.

${reservationDetails}

Your reservation is confirmed. Please arrive on time.

TIP: Log back into the reservation system and click "Download Calendar" to add this to your Outlook calendar.

Thank you,
KIPP Antioch Global Campus`;

                        console.log('ðŸ“¤ Sending approval email to:', userEmail);
                        // Send to user
                        const formData = new FormData();
                        formData.append('email', userEmail);
                        formData.append('_subject', subject);
                        formData.append('message', message);
                        formData.append('_replyto', 'noreply@kippnashville.org');
                        formData.append('_template', 'table');

                        const response = await fetch(`https://formsubmit.co/${userEmail}`, {
                            method: 'POST',
                            body: formData
                        });
                        
                        console.log('âœ… Approval email response:', response.status);

                        // Send to secondary email if provided
                        if (secondaryEmail) {
                            console.log('ðŸ“¤ Sending approval email to secondary:', secondaryEmail);
                            const secondaryFormData = new FormData();
                            secondaryFormData.append('email', secondaryEmail);
                            secondaryFormData.append('_subject', subject);
                            secondaryFormData.append('message', message);
                            secondaryFormData.append('_replyto', 'noreply@kippnashville.org');
                            secondaryFormData.append('_template', 'table');

                            await fetch(`https://formsubmit.co/${secondaryEmail}`, {
                                method: 'POST',
                                body: secondaryFormData
                            });
                            console.log('âœ… Secondary approval email sent');
                        }
                    }

                    // DENIAL EMAIL
                    else if (type === 'denial') {
                        subject = `âŒ Reservation DENIED - ${reservation.location}`;
                        message = `Dear ${reservation.firstName} ${reservation.lastName},

We regret to inform you that your reservation has been DENIED.

${reservationDetails}

If you have questions, please contact the administration office.

Thank you,
KIPP Antioch Global Campus`;

                        console.log('ðŸ“¤ Sending denial email to:', userEmail);
                        // Send to user
                        const formData = new FormData();
                        formData.append('email', userEmail);
                        formData.append('_subject', subject);
                        formData.append('message', message);
                        formData.append('_replyto', 'noreply@kippnashville.org');
                        formData.append('_template', 'table');

                        const response = await fetch(`https://formsubmit.co/${userEmail}`, {
                            method: 'POST',
                            body: formData
                        });
                        
                        console.log('âœ… Denial email response:', response.status);

                        // Send to secondary email if provided
                        if (secondaryEmail) {
                            console.log('ðŸ“¤ Sending denial email to secondary:', secondaryEmail);
                            const secondaryFormData = new FormData();
                            secondaryFormData.append('email', secondaryEmail);
                            secondaryFormData.append('_subject', subject);
                            secondaryFormData.append('message', message);
                            secondaryFormData.append('_replyto', 'noreply@kippnashville.org');
                            secondaryFormData.append('_template', 'table');

                            await fetch(`https://formsubmit.co/${secondaryEmail}`, {
                                method: 'POST',
                                body: secondaryFormData
                            });
                            console.log('âœ… Secondary denial email sent');
                        }
                    }

                    // PENDING EMAIL (sent to admins only)
                    else if (type === 'pending') {
                        subject = `â³ NEW RESERVATION PENDING - ${reservation.location}`;
                        message = `A new reservation is awaiting your review:

${reservationDetails}

Status: PENDING APPROVAL

Please log in to the reservation system to approve or deny this request.

KIPP Antioch Global Campus Reservation System`;

                        console.log('ðŸ“¤ Sending pending notifications to', ADMIN_NOTIFICATION_EMAILS.length, 'admins');
                        // Send to all admins
                        for (const adminEmail of ADMIN_NOTIFICATION_EMAILS) {
                            console.log('ðŸ“¤ Sending to admin:', adminEmail);
                            const adminFormData = new FormData();
                            adminFormData.append('email', adminEmail);
                            adminFormData.append('_subject', subject);
                            adminFormData.append('message', message);
                            adminFormData.append('_replyto', userEmail); // Admin can reply to user
                            adminFormData.append('_template', 'table');

                            try {
                                const response = await fetch(`https://formsubmit.co/${adminEmail}`, {
                                    method: 'POST',
                                    body: adminFormData
                                });
                                console.log(`âœ… Email sent to ${adminEmail}, status:`, response.status);
                            } catch (err) {
                                console.error(`âŒ Failed to send to ${adminEmail}:`, err);
                            }
                        }
                    }

                    console.log('ðŸ“§ Email process completed!');
                } catch (error) {
                    console.error('âŒ Error sending email:', error);
                    alert('Warning: Email notification may have failed. Please contact an admin to confirm your reservation was received.');
                }
            };

            const downloadOutlookCalendar = (reservation) => {
                const startDate = new Date(reservation.date);
                let timeStr = reservation.timeSlot;
                const isPM = timeStr.includes('PM');
                timeStr = timeStr.replace(' AM', '').replace(' PM', '');
                const [hours, minutes] = timeStr.split(':');
                let hour = parseInt(hours);
                if (isPM && hour !== 12) hour += 12;
                else if (!isPM && hour === 12) hour = 0;
                
                startDate.setHours(hour, parseInt(minutes));
                const endDate = new Date(startDate);
                endDate.setMinutes(endDate.getMinutes() + reservation.duration);
                
                const formatICSDate = (date) => date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
                
                // Enhanced description with all details
                const description = `KIPP Antioch Global Campus Reservation\\n\\n` +
                    `Contact: ${reservation.firstName} ${reservation.lastName}\\n` +
                    `Email: ${reservation.email}\\n` +
                    `Phone: ${reservation.phone}\\n` +
                    `School: ${reservation.school}\\n` +
                    `Number of People: ${reservation.numberOfPeople}\\n` +
                    `Purpose: ${reservation.purpose}\\n` +
                    `${reservation.notes ? `Notes: ${reservation.notes}\\n` : ''}` +
                    `\\nStatus: ${reservation.status.toUpperCase()}`;
                
                // Create ICS file with better Microsoft Office compatibility
                const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//KIPP Antioch//Reservation Calendar//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
X-WR-CALNAME:KIPP Reservations
X-WR-TIMEZONE:America/Chicago
BEGIN:VEVENT
UID:${reservation.id}@kippnashville.org
DTSTAMP:${formatICSDate(new Date())}
DTSTART:${formatICSDate(startDate)}
DTEND:${formatICSDate(endDate)}
SUMMARY:${reservation.location} - ${reservation.purpose}
DESCRIPTION:${description}
LOCATION:${reservation.location}, KIPP Antioch Global Campus
ORGANIZER;CN=${reservation.firstName} ${reservation.lastName}:mailto:${reservation.email}
STATUS:${reservation.status === 'approved' ? 'CONFIRMED' : 'TENTATIVE'}
SEQUENCE:0
TRANSP:OPAQUE
END:VEVENT
END:VCALENDAR`;
                
                const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `KIPP-Reservation-${reservation.location.replace(/\s+/g, '-')}-${reservation.id}.ics`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            // Add function to create Outlook web calendar link
            const openOutlookWeb = (reservation) => {
                const startDate = new Date(reservation.date);
                let timeStr = reservation.timeSlot;
                const isPM = timeStr.includes('PM');
                timeStr = timeStr.replace(' AM', '').replace(' PM', '');
                const [hours, minutes] = timeStr.split(':');
                let hour = parseInt(hours);
                if (isPM && hour !== 12) hour += 12;
                else if (!isPM && hour === 12) hour = 0;
                
                startDate.setHours(hour, parseInt(minutes));
                const endDate = new Date(startDate);
                endDate.setMinutes(endDate.getMinutes() + reservation.duration);
                
                // Format for Outlook.com
                const formatOutlookDate = (date) => date.toISOString().replace(/[-:]/g, '').split('.')[0];
                
                const params = new URLSearchParams({
                    path: '/calendar/action/compose',
                    rru: 'addevent',
                    startdt: formatOutlookDate(startDate),
                    enddt: formatOutlookDate(endDate),
                    subject: `${reservation.location} - ${reservation.purpose}`,
                    body: `KIPP Antioch Global Campus Reservation\n\nContact: ${reservation.firstName} ${reservation.lastName}\nEmail: ${reservation.email}\nPhone: ${reservation.phone}\nSchool: ${reservation.school}\nPeople: ${reservation.numberOfPeople}\n\nStatus: ${reservation.status.toUpperCase()}`,
                    location: `${reservation.location}, KIPP Antioch Global Campus`
                });
                
                window.open(`https://outlook.live.com/calendar/0/deeplink/compose?${params.toString()}`, '_blank');
            };

            // Add function for Google Calendar
            const openGoogleCalendar = (reservation) => {
                const startDate = new Date(reservation.date);
                let timeStr = reservation.timeSlot;
                const isPM = timeStr.includes('PM');
                timeStr = timeStr.replace(' AM', '').replace(' PM', '');
                const [hours, minutes] = timeStr.split(':');
                let hour = parseInt(hours);
                if (isPM && hour !== 12) hour += 12;
                else if (!isPM && hour === 12) hour = 0;
                
                startDate.setHours(hour, parseInt(minutes));
                const endDate = new Date(startDate);
                endDate.setMinutes(endDate.getMinutes() + reservation.duration);
                
                // Format for Google Calendar
                const formatGoogleDate = (date) => date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
                
                const params = new URLSearchParams({
                    action: 'TEMPLATE',
                    text: `${reservation.location} - ${reservation.purpose}`,
                    dates: `${formatGoogleDate(startDate)}/${formatGoogleDate(endDate)}`,
                    details: `KIPP Antioch Global Campus Reservation\n\nContact: ${reservation.firstName} ${reservation.lastName}\nEmail: ${reservation.email}\nPhone: ${reservation.phone}\nSchool: ${reservation.school}\nPeople: ${reservation.numberOfPeople}\n\nStatus: ${reservation.status.toUpperCase()}`,
                    location: `${reservation.location}, KIPP Antioch Global Campus`
                });
                
                window.open(`https://calendar.google.com/calendar/render?${params.toString()}`, '_blank');
            };

            const handleFormChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                
                if (selectedLocations.length === 0 || !selectedDate || !selectedTimeSlot || !selectedEndTime) {
                    alert('Please select at least one location, date, start time, and end time');
                    return;
                }

                // Check if Global Gym is selected
                const gymSelected = selectedLocations.some(loc => loc.id === 1); // Global Gym has id 1
                if (gymSelected) {
                    alert('Please contact any Global Athletic Directors regarding the installation of floor coverings if tables or chairs are needed during gym usage.');
                }

                const calculatedDuration = calculateDuration(selectedTimeSlot, selectedEndTime);
                const newReservations = [];

                // Create a reservation for each selected location
                selectedLocations.forEach(location => {
                    const newReservation = {
                        id: generateId(),
                        ...formData,
                        location: location.name,
                        locationId: location.id,
                        date: selectedDate.toISOString(),
                        timeSlot: selectedTimeSlot,
                        endTime: selectedEndTime,
                        duration: calculatedDuration,
                        status: 'pending',
                        createdAt: new Date().toISOString(),
                        color: location.color
                    };
                    newReservations.push(newReservation);
                });

                if (editingReservation) {
                    // When editing, just update the single reservation
                    const updatedReservation = {
                        ...editingReservation,
                        ...formData,
                        location: selectedLocations[0].name,
                        locationId: selectedLocations[0].id,
                        date: selectedDate.toISOString(),
                        timeSlot: selectedTimeSlot,
                        endTime: selectedEndTime,
                        duration: calculatedDuration
                    };
                    
                    // Update in Google Sheets
                    await updateGoogleSheets(updatedReservation);
                    
                    setReservations(prev => prev.map(r => r.id === editingReservation.id ? updatedReservation : r));
                    setSuccessMessage('Reservation updated successfully!');
                } else {
                    // Save each new reservation to Google Sheets
                    for (const reservation of newReservations) {
                        await saveToGoogleSheets(reservation);
                    }
                    
                    // Add all new reservations to local state
                    setReservations(prev => [...prev, ...newReservations]);
                    const locationNames = selectedLocations.map(l => l.name).join(', ');
                    setSuccessMessage(`${newReservations.length} reservation${newReservations.length > 1 ? 's' : ''} created successfully! (${locationNames}) Admins have been notified.`);
                    setLastCreatedReservation(newReservations[0]);
                    setShowCalendarDownload(true);
                    
                    // Send pending email for each reservation
                    newReservations.forEach(res => sendEmail('pending', res));
                }

                setFormData({
                    firstName: '', lastName: '', email: '', phone: '', school: '',
                    numberOfPeople: 1, purpose: '', notes: '', secondaryEmail: ''
                });
                setSelectedDate(null);
                setSelectedTimeSlot(null);
                setSelectedEndTime(null);
                setSelectedLocations([]);
                setEditingReservation(null);
                setShowModal(false);
                setTimeout(() => {
                    setSuccessMessage('');
                    setShowCalendarDownload(false);
                }, 8000);
            };

            const updateReservation = (id, updates) => {
                setReservations(prev => prev.map(r => r.id === id ? { ...r, ...updates } : r));
            };

            const approveReservation = async (id) => {
                const reservation = reservations.find(r => r.id === id);
                const updatedReservation = { ...reservation, status: 'approved' };
                
                // Update in Google Sheets
                await updateGoogleSheets(updatedReservation);
                
                updateReservation(id, { status: 'approved' });
                sendEmail('approval', updatedReservation);
                setSuccessMessage('âœ… Reservation approved and confirmation sent!');
                setTimeout(() => setSuccessMessage(''), 3000);
            };

            const denyReservation = async (id) => {
                if (confirm('Are you sure you want to deny this reservation?')) {
                    const reservation = reservations.find(r => r.id === id);
                    const updatedReservation = { ...reservation, status: 'denied' };
                    
                    // Update in Google Sheets
                    await updateGoogleSheets(updatedReservation);
                    
                    updateReservation(id, { status: 'denied' });
                    sendEmail('denial', updatedReservation);
                    setSuccessMessage('âŒ Reservation denied and notification sent.');
                    setTimeout(() => setSuccessMessage(''), 3000);
                }
            };

            const deleteReservation = async (id) => {
                if (confirm('Are you sure you want to delete this reservation?')) {
                    // Delete from Google Sheets
                    await deleteFromGoogleSheets(id);
                    
                    setReservations(prev => prev.filter(r => r.id !== id));
                    setSuccessMessage('Reservation deleted.');
                    setTimeout(() => setSuccessMessage(''), 3000);
                }
            };

            const editReservation = (reservation) => {
                setEditingReservation(reservation);
                setFormData({
                    firstName: reservation.firstName, lastName: reservation.lastName,
                    email: reservation.email, phone: reservation.phone, school: reservation.school,
                    numberOfPeople: reservation.numberOfPeople,
                    purpose: reservation.purpose, notes: reservation.notes || '',
                    secondaryEmail: reservation.secondaryEmail || ''
                });
                const location = LOCATIONS.find(l => l.id === reservation.locationId);
                setSelectedLocations(location ? [location] : []);
                setSelectedDate(new Date(reservation.date));
                setSelectedTimeSlot(reservation.timeSlot);
                setSelectedEndTime(reservation.endTime || null);
                setActiveTab('calendar');
                setShowModal(true);
            };

            const renderCalendar = () => {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const daysInMonth = getDaysInMonth(year, month);
                const firstDay = getFirstDayOfMonth(year, month);
                const days = [];
                const prevMonthDays = getDaysInMonth(year, month - 1);
                
                for (let i = firstDay - 1; i >= 0; i--) {
                    days.push({ day: prevMonthDays - i, isCurrentMonth: false, date: new Date(year, month - 1, prevMonthDays - i) });
                }
                
                for (let i = 1; i <= daysInMonth; i++) {
                    const date = new Date(year, month, i);
                    const hasReservation = reservations.some(r => new Date(r.date).toDateString() === date.toDateString());
                    days.push({
                        day: i, isCurrentMonth: true, date: date, hasReservation: hasReservation,
                        isPast: date < new Date().setHours(0, 0, 0, 0)
                    });
                }
                
                const remainingDays = 42 - days.length;
                for (let i = 1; i <= remainingDays; i++) {
                    days.push({ day: i, isCurrentMonth: false, date: new Date(year, month + 1, i) });
                }
                
                return days;
            };

            const getAvailableEndTimes = () => {
                if (!selectedTimeSlot || !selectedDate || selectedLocations.length === 0) return [];
                
                const startIndex = TIME_SLOTS.indexOf(selectedTimeSlot);
                if (startIndex === -1) return [];
                
                // Find the earliest conflicting reservation across ALL selected locations
                let maxEndIndex = TIME_SLOTS.length;
                
                selectedLocations.forEach(location => {
                    reservations.forEach(r => {
                        const resDate = new Date(r.date);
                        if (resDate.toDateString() === selectedDate.toDateString() && 
                            r.locationId === location.id && 
                            r.status !== 'denied' &&
                            r.timeSlot) {
                            
                            const resStartIndex = TIME_SLOTS.indexOf(r.timeSlot);
                            
                            // If this reservation starts after our selected start time
                            if (resStartIndex > startIndex) {
                                // Limit our end time to not overlap with this reservation
                                maxEndIndex = Math.min(maxEndIndex, resStartIndex);
                            }
                        }
                    });
                });
                
                // Return all time slots after the selected start time up to the next reservation
                return TIME_SLOTS.slice(startIndex + 1, maxEndIndex);
            };

            const toggleLocationSelection = (location) => {
                setSelectedLocations(prev => {
                    const isSelected = prev.some(loc => loc.id === location.id);
                    if (isSelected) {
                        // Remove location
                        return prev.filter(loc => loc.id !== location.id);
                    } else {
                        // Add location
                        return [...prev, location];
                    }
                });
            };

            const getBookedTimeSlots = () => {
                if (!selectedTimeSlot || !selectedEndTime) return [];
                
                const startIndex = TIME_SLOTS.indexOf(selectedTimeSlot);
                const endIndex = TIME_SLOTS.indexOf(selectedEndTime);
                
                if (startIndex === -1 || endIndex === -1) return [];
                
                // Return all slots from start up to (but not including) end
                return TIME_SLOTS.slice(startIndex, endIndex);
            };

            const formatDuration = (minutes) => {
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;
                
                if (hours === 0) return `${mins} minutes`;
                if (mins === 0) return hours === 1 ? `1 hour` : `${hours} hours`;
                return `${hours} hour${hours > 1 ? 's' : ''} ${mins} minutes`;
            };

            const calculateDuration = (startTime, endTime) => {
                if (!startTime || !endTime) return 60;
                
                const startIndex = TIME_SLOTS.indexOf(startTime);
                const endIndex = TIME_SLOTS.indexOf(endTime);
                
                if (startIndex === -1 || endIndex === -1 || endIndex <= startIndex) return 60;
                
                // Each slot is 30 minutes apart
                return (endIndex - startIndex) * 30;
            };

            const nextMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1));
            const prevMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1));

            const filteredReservations = reservations.filter(r => {
                if (filterStatus !== 'all' && r.status !== filterStatus) return false;
                if (filterLocation !== 'all' && r.locationId !== parseInt(filterLocation)) return false;
                return true;
            });

            const stats = {
                total: reservations.length,
                pending: reservations.filter(r => r.status === 'pending').length,
                approved: reservations.filter(r => r.status === 'approved').length,
                denied: reservations.filter(r => r.status === 'denied').length
            };

            return (
                <>
                    <div className="header">
                        <h1>KIPP Antioch Global Campus Reservation Calendar</h1>
                        <p style={{marginTop: '15px', lineHeight: '1.6', fontSize: '1em'}}>
                            <strong>#OneKIPP</strong><br/>
                            Please leave spaces better than you found them. If there are any custodial or tech needs please be sure to email <strong>GlobalDOO@kippnashville.org</strong><br/>
                            <strong>Thank you</strong><br/>
                            <em>-KIPP Antioch Global Campus Admin</em>
                        </p>
                    </div>

                    {successMessage && (
                        <div className="success-message">
                            {successMessage}
                            {showCalendarDownload && lastCreatedReservation && (
                                <div style={{marginTop: '15px'}}>
                                    <div style={{marginBottom: '10px', fontWeight: 'bold'}}>Add to Your Calendar:</div>
                                    <div style={{display: 'flex', gap: '10px', flexWrap: 'wrap', justifyContent: 'center'}}>
                                        <button 
                                            className="btn btn-primary" 
                                            onClick={() => downloadOutlookCalendar(lastCreatedReservation)}
                                            style={{padding: '12px 20px', fontSize: '0.95em', flex: '1 1 auto'}}>
                                            ðŸ“¥ Download .ics File
                                        </button>
                                        <button 
                                            className="btn btn-primary" 
                                            onClick={() => openOutlookWeb(lastCreatedReservation)}
                                            style={{padding: '12px 20px', fontSize: '0.95em', flex: '1 1 auto'}}>
                                            ðŸ“§ Outlook.com
                                        </button>
                                        <button 
                                            className="btn btn-primary" 
                                            onClick={() => openGoogleCalendar(lastCreatedReservation)}
                                            style={{padding: '12px 20px', fontSize: '0.95em', flex: '1 1 auto'}}>
                                            ðŸ“… Google Calendar
                                        </button>
                                    </div>
                                    <div style={{marginTop: '8px', fontSize: '0.85em', color: 'var(--text-mid)'}}>
                                        .ics file works with Outlook Desktop, Apple Calendar, and most email clients
                                    </div>
                                </div>
                            )}
                        </div>
                    )}

                    <div className="nav-tabs">
                        <button className={`nav-tab ${activeTab === 'calendar' ? 'active' : ''}`} onClick={() => setActiveTab('calendar')}>
                            ðŸ“… Make Reservation
                        </button>
                        <button className={`nav-tab ${activeTab === 'admin' ? 'active' : ''}`} onClick={() => setActiveTab('admin')}>
                            âš™ï¸ Admin Panel
                        </button>
                    </div>

                    {activeTab === 'calendar' && (
                        <>
                            <div className="card" style={{background: 'linear-gradient(135deg, #e8e8e8 0%, #d0d0d0 100%)'}}>
                                <h2 style={{color: '#17345b', textShadow: '1px 1px 2px rgba(255,255,255,0.5)'}}>ðŸ“ Select Global Campus Location(s)</h2>
                                <p style={{color: '#17345b', marginBottom: '20px', fontWeight: '500'}}>You can select multiple locations for the same reservation</p>
                                <div className="location-grid">
                                    {LOCATIONS.map(location => {
                                        const isSelected = selectedLocations.some(loc => loc.id === location.id);
                                        const lightColors = ['#fcda00', '#b9d3e7', '#f7941e']; // Yellow, light blue, orange
                                        const needsDarkText = lightColors.includes(location.color);
                                        
                                        return (
                                            <div key={location.id} 
                                                className={`location-card ${isSelected ? 'selected' : ''}`}
                                                onClick={() => toggleLocationSelection(location)}
                                                style={{
                                                    borderColor: location.color,
                                                    borderWidth: '3px',
                                                    background: isSelected 
                                                        ? location.color 
                                                        : `linear-gradient(135deg, #FFFFFF 0%, ${location.color}15 100%)`,
                                                    color: isSelected && needsDarkText ? '#1A1A1A' : (isSelected ? 'white' : 'inherit')
                                                }}>
                                                <h3>
                                                    {isSelected && 'âœ“ '}
                                                    {location.name}
                                                </h3>
                                                <p style={{opacity: isSelected ? 0.9 : 0.7}}>{location.address}</p>
                                            </div>
                                        );
                                    })}
                                </div>
                                
                                <div style={{marginTop: '25px', padding: '15px', background: 'rgba(44, 95, 45, 0.05)', borderRadius: '12px'}}>
                                    <strong style={{display: 'block', marginBottom: '10px', color: 'var(--primary)'}}>ðŸ“Œ Color Legend:</strong>
                                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '10px'}}>
                                        <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                            <div style={{width: '20px', height: '20px', borderRadius: '4px', backgroundColor: '#255694', border: '1px solid #ccc'}}></div>
                                            <span>Gym</span>
                                        </div>
                                        <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                            <div style={{width: '20px', height: '20px', borderRadius: '4px', backgroundColor: '#9b59b6', border: '1px solid #ccc'}}></div>
                                            <span>Soccer Field</span>
                                        </div>
                                        <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                            <div style={{width: '20px', height: '20px', borderRadius: '4px', backgroundColor: '#e84393', border: '1px solid #ccc'}}></div>
                                            <span>Cafeteria 1</span>
                                        </div>
                                        <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                            <div style={{width: '20px', height: '20px', borderRadius: '4px', backgroundColor: '#e74c3c', border: '1px solid #ccc'}}></div>
                                            <span>Storm Shelter</span>
                                        </div>
                                        <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                            <div style={{width: '20px', height: '20px', borderRadius: '4px', backgroundColor: '#f7941e', border: '1px solid #ccc'}}></div>
                                            <span>Multi-Purpose Room</span>
                                        </div>
                                        <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                            <div style={{width: '20px', height: '20px', borderRadius: '4px', backgroundColor: '#b9d3e7', border: '1px solid #ccc'}}></div>
                                            <span>HS Conference Room</span>
                                        </div>
                                        <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                            <div style={{width: '20px', height: '20px', borderRadius: '4px', backgroundColor: '#fcda00', border: '1px solid #ccc'}}></div>
                                            <span>ES/MS Conference Room</span>
                                        </div>
                                        <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                            <div style={{width: '20px', height: '20px', borderRadius: '4px', backgroundColor: '#638c1c', border: '1px solid #ccc'}}></div>
                                            <span>KIPP Forward</span>
                                        </div>
                                    </div>
                                    <p style={{marginTop: '10px', fontSize: '0.9em', color: 'var(--text-mid)', fontStyle: 'italic'}}>
                                        Calendar dates show location names and times in white text. Each reservation gets its own color. Multiple reservations show as diagonal color stripes.
                                    </p>
                                </div>
                            </div>

                            {selectedLocations.length > 0 && (
                                <div className="card" ref={calendarRef}>
                                    <div className="calendar-header">
                                        <h3>{currentDate.toLocaleString('default', { month: 'long', year: 'numeric' })}</h3>
                                        <div className="calendar-nav">
                                            <button className="btn btn-secondary" onClick={prevMonth}>â† Previous</button>
                                            <button className="btn btn-secondary" onClick={nextMonth}>Next â†’</button>
                                        </div>
                                    </div>

                                    <div className="calendar-grid">
                                        {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                                            <div key={day} className="calendar-day-header">{day}</div>
                                        ))}
                                        {renderCalendar().map((day, idx) => {
                                            // Get all reservations for this day (not just unique colors)
                                            const dayReservations = reservations.filter(r => 
                                                new Date(r.date).toDateString() === day.date.toDateString() && r.status !== 'denied'
                                            );
                                            
                                            // Assign a unique color to each reservation
                                            const reservationsWithColors = dayReservations.map((r, index) => {
                                                const location = LOCATIONS.find(l => l.id === r.locationId);
                                                // Use location's brand color, or generate additional colors if needed
                                                let color = location?.color;
                                                if (!color && index >= LOCATIONS.length) {
                                                    const additionalColors = generateAdditionalColors(20);
                                                    color = additionalColors[index - LOCATIONS.length] || '#888888';
                                                }
                                                return {
                                                    ...r,
                                                    color: color,
                                                    locationName: location?.name || 'Unknown'
                                                };
                                            });
                                            
                                            const isSelected = selectedDate?.toDateString() === day.date.toDateString();
                                            const hasReservations = reservationsWithColors.length > 0;
                                            
                                            // Create gradient background for multiple reservations
                                            let backgroundStyle = {};
                                            if (hasReservations && !isSelected) {
                                                if (reservationsWithColors.length === 1) {
                                                    backgroundStyle = { 
                                                        backgroundColor: reservationsWithColors[0].color
                                                    };
                                                } else if (reservationsWithColors.length === 2) {
                                                    backgroundStyle = { 
                                                        background: `linear-gradient(135deg, ${reservationsWithColors[0].color} 0%, ${reservationsWithColors[0].color} 50%, ${reservationsWithColors[1].color} 50%, ${reservationsWithColors[1].color} 100%)`
                                                    };
                                                } else if (reservationsWithColors.length === 3) {
                                                    backgroundStyle = { 
                                                        background: `linear-gradient(135deg, ${reservationsWithColors[0].color} 0%, ${reservationsWithColors[0].color} 33%, ${reservationsWithColors[1].color} 33%, ${reservationsWithColors[1].color} 66%, ${reservationsWithColors[2].color} 66%, ${reservationsWithColors[2].color} 100%)`
                                                    };
                                                } else if (reservationsWithColors.length >= 4) {
                                                    backgroundStyle = { 
                                                        background: `linear-gradient(135deg, ${reservationsWithColors[0].color} 0%, ${reservationsWithColors[0].color} 25%, ${reservationsWithColors[1].color} 25%, ${reservationsWithColors[1].color} 50%, ${reservationsWithColors[2].color} 50%, ${reservationsWithColors[2].color} 75%, ${reservationsWithColors[3].color} 75%, ${reservationsWithColors[3].color} 100%)`
                                                    };
                                                }
                                            }
                                            
                                            return (
                                                <div key={idx} className={`calendar-day 
                                                    ${!day.isCurrentMonth ? 'other-month' : ''} 
                                                    ${day.isPast ? 'disabled' : ''}
                                                    ${isSelected ? 'selected' : ''}
                                                    ${day.hasReservation ? 'has-reservation' : ''}`}
                                                    style={hasReservations && !isSelected ? {
                                                        ...backgroundStyle,
                                                        color: 'white',
                                                        fontWeight: 'bold',
                                                        textShadow: '1px 1px 2px rgba(0,0,0,0.7)',
                                                        padding: '3px',
                                                        display: 'flex',
                                                        flexDirection: 'column',
                                                        alignItems: 'center',
                                                        justifyContent: 'flex-start',
                                                        fontSize: '0.75em',
                                                        overflow: 'hidden'
                                                    } : {}}
                                                    onClick={() => { if (day.isCurrentMonth && !day.isPast) { setSelectedDate(day.date); setSelectedTimeSlot(null); setSelectedEndTime(null); } }}>
                                                    <div style={{fontSize: hasReservations ? '1.4em' : '1em', fontWeight: 'bold', marginBottom: hasReservations ? '2px' : '0'}}>{day.day}</div>
                                                    {hasReservations && !isSelected && (
                                                        <div style={{
                                                            fontSize: '0.75em',
                                                            lineHeight: '1.15',
                                                            textAlign: 'center',
                                                            overflow: 'auto',
                                                            width: '100%',
                                                            maxHeight: '75px',
                                                            scrollbarWidth: 'none',
                                                            msOverflowStyle: 'none'
                                                        }}>
                                                            {reservationsWithColors.map((res, i) => (
                                                                <div key={i} style={{
                                                                    marginBottom: '3px',
                                                                    paddingX: '2px'
                                                                }}>
                                                                    <div style={{
                                                                        fontWeight: 'bold',
                                                                        whiteSpace: 'nowrap',
                                                                        overflow: 'hidden',
                                                                        textOverflow: 'ellipsis'
                                                                    }}>
                                                                        {res.locationName.replace('Global ', '').replace(' Family Conference Room', '').replace('Storm Shelter (Cafeteria 2)', 'Shelter')}
                                                                    </div>
                                                                    <div style={{
                                                                        fontSize: '0.95em', 
                                                                        opacity: 0.95,
                                                                        whiteSpace: 'nowrap'
                                                                    }}>
                                                                        {res.timeSlot}-{res.endTime}
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>

                                    {selectedDate && (
                                        <>
                                            <h3 style={{marginTop: '30px', color: 'var(--primary)'}} ref={timeSlotsRef}>
                                                Select Time - {formatDate(selectedDate)}
                                            </h3>
                                            <div style={{marginBottom: '15px', color: 'var(--text-mid)', fontSize: '0.95em'}}>
                                                Choose your start time, then select an end time to complete your reservation.
                                            </div>
                                            <div className="time-slots">
                                                {TIME_SLOTS.map(time => {
                                                    const bookedSlots = getBookedTimeSlots();
                                                    const isInRange = bookedSlots.includes(time);
                                                    const isEndTime = selectedEndTime === time;
                                                    
                                                    // Check if time is booked for ANY of the selected locations
                                                    const isBooked = selectedLocations.some(location => {
                                                        return reservations.some(r => {
                                                            const resDate = new Date(r.date);
                                                            if (resDate.toDateString() !== selectedDate.toDateString() || 
                                                                r.locationId !== location.id || 
                                                                r.status === 'denied') {
                                                                return false;
                                                            }
                                                            
                                                            if (r.endTime) {
                                                                const timeIndex = TIME_SLOTS.indexOf(time);
                                                                const resStartIndex = TIME_SLOTS.indexOf(r.timeSlot);
                                                                const resEndIndex = TIME_SLOTS.indexOf(r.endTime);
                                                                return timeIndex >= resStartIndex && timeIndex < resEndIndex;
                                                            } else {
                                                                return r.timeSlot === time;
                                                            }
                                                        });
                                                    });
                                                    
                                                    // Check if this time would be in the middle of the selected reservation
                                                    const wouldBeInMiddle = selectedTimeSlot && selectedEndTime && 
                                                        TIME_SLOTS.indexOf(time) > TIME_SLOTS.indexOf(selectedTimeSlot) &&
                                                        TIME_SLOTS.indexOf(time) < TIME_SLOTS.indexOf(selectedEndTime);
                                                    
                                                    const isAvailableEndTime = selectedTimeSlot && getAvailableEndTimes().includes(time);
                                                    
                                                    return (
                                                        <div key={time} 
                                                            className={`time-slot 
                                                                ${selectedTimeSlot === time ? 'selected' : ''} 
                                                                ${isBooked ? 'disabled' : ''}
                                                                ${wouldBeInMiddle ? 'disabled' : ''}
                                                                ${isInRange && selectedEndTime ? 'booked-range' : ''}
                                                                ${isEndTime ? 'selected' : ''}`}
                                                            onClick={() => { 
                                                                if (!isBooked && !wouldBeInMiddle) {
                                                                    if (!selectedTimeSlot) {
                                                                        setSelectedTimeSlot(time);
                                                                        setSelectedEndTime(null);
                                                                    } else if (isAvailableEndTime) {
                                                                        setSelectedEndTime(time);
                                                                    } else {
                                                                        setSelectedTimeSlot(time);
                                                                        setSelectedEndTime(null);
                                                                    }
                                                                }
                                                            }}
                                                            style={{
                                                                opacity: wouldBeInMiddle && !isBooked ? 0.5 : 1
                                                            }}>
                                                            {time}
                                                            {isBooked && <div style={{fontSize: '0.8em', marginTop: '3px'}}>Booked</div>}
                                                            {wouldBeInMiddle && !isBooked && <div style={{fontSize: '0.8em', marginTop: '3px', color: '#888'}}>In Range</div>}
                                                            {selectedTimeSlot === time && !isBooked && !wouldBeInMiddle && <div style={{fontSize: '0.8em', marginTop: '3px'}}>Start</div>}
                                                            {isEndTime && <div style={{fontSize: '0.8em', marginTop: '3px'}}>End</div>}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </>
                                    )}

                                    {selectedEndTime && (
                                        <button className="btn btn-primary" 
                                            style={{marginTop: '20px', width: '100%', padding: '16px', fontSize: '1.1em'}}
                                            onClick={() => setShowModal(true)}>
                                            Continue to Reservation Form â†’
                                        </button>
                                    )}
                                </div>
                            )}
                        </>
                    )}

                    {activeTab === 'admin' && !isAdminAuthenticated && (
                        <div className="card">
                            <div className="login-container">
                                <h2>ðŸ” Admin Login Required</h2>
                                <p>Please enter your authorized email address and password to access the admin panel.</p>
                                
                                {loginError && <div className="error-message">{loginError}</div>}
                                
                                <form onSubmit={handleAdminLogin} className="login-form">
                                    <div className="form-group">
                                        <input type="email" placeholder="Enter your email address" value={adminEmail}
                                            onChange={(e) => setAdminEmail(e.target.value)} required style={{textAlign: 'center'}} />
                                    </div>
                                    <div className="form-group">
                                        <input type="password" placeholder="Enter password" value={adminPassword}
                                            onChange={(e) => setAdminPassword(e.target.value)} required style={{textAlign: 'center'}} />
                                    </div>
                                    <button type="submit" className="btn btn-primary">Login to Admin Panel</button>
                                </form>
                            </div>
                        </div>
                    )}

                    {activeTab === 'admin' && isAdminAuthenticated && (
                        <>
                            <div className="admin-info">
                                <div>
                                    <div style={{fontSize: '0.9em', opacity: 0.9}}>Logged in as</div>
                                    <div className="admin-email">{adminEmail}</div>
                                </div>
                                <button className="logout-btn" onClick={handleAdminLogout}>Logout</button>
                            </div>

                            <div className="stats-grid">
                                <div className="stat-card">
                                    <div className="stat-value">{stats.total}</div>
                                    <div className="stat-label">Total</div>
                                </div>
                                <div className="stat-card">
                                    <div className="stat-value">{stats.pending}</div>
                                    <div className="stat-label">Pending</div>
                                </div>
                                <div className="stat-card">
                                    <div className="stat-value">{stats.approved}</div>
                                    <div className="stat-label">Approved</div>
                                </div>
                                <div className="stat-card">
                                    <div className="stat-value">{stats.denied}</div>
                                    <div className="stat-label">Denied</div>
                                </div>
                            </div>

                            <div className="card">
                                <h2>âš™ï¸ Manage Reservations</h2>
                                
                                <div className="filter-bar">
                                    <select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)}>
                                        <option value="all">All Status</option>
                                        <option value="pending">Pending</option>
                                        <option value="approved">Approved</option>
                                        <option value="denied">Denied</option>
                                    </select>
                                    <select value={filterLocation} onChange={(e) => setFilterLocation(e.target.value)}>
                                        <option value="all">All Locations</option>
                                        {LOCATIONS.map(loc => <option key={loc.id} value={loc.id}>{loc.name}</option>)}
                                    </select>
                                </div>

                                <div className="reservation-list">
                                    {filteredReservations.length === 0 ? (
                                        <p style={{textAlign: 'center', padding: '40px', color: 'var(--text-light)'}}>
                                            No reservations found
                                        </p>
                                    ) : (
                                        filteredReservations.map(reservation => (
                                            <div key={reservation.id} className={`reservation-item status-${reservation.status}`}>
                                                <div className="reservation-header">
                                                    <div className="reservation-title">{reservation.firstName} {reservation.lastName}</div>
                                                    <div className={`reservation-status status-${reservation.status}`}>{reservation.status}</div>
                                                </div>
                                                <div className="reservation-details">
                                                    <div className="reservation-detail-item">
                                                        <span className="reservation-detail-label">Location</span>{reservation.location}
                                                    </div>
                                                    <div className="reservation-detail-item">
                                                        <span className="reservation-detail-label">Date</span>{formatDate(reservation.date)}
                                                    </div>
                                                    <div className="reservation-detail-item">
                                                        <span className="reservation-detail-label">Time</span>{reservation.timeSlot}
                                                    </div>
                                                    <div className="reservation-detail-item">
                                                        <span className="reservation-detail-label">End Time</span>{reservation.endTime || 'N/A'}
                                                    </div>
                                                    <div className="reservation-detail-item">
                                                        <span className="reservation-detail-label">Duration</span>{formatDuration(reservation.duration)}
                                                    </div>
                                                    <div className="reservation-detail-item">
                                                        <span className="reservation-detail-label">School</span>{reservation.school}
                                                    </div>
                                                    <div className="reservation-detail-item">
                                                        <span className="reservation-detail-label">Email</span>{reservation.email}
                                                    </div>
                                                    {reservation.secondaryEmail && (
                                                        <div className="reservation-detail-item">
                                                            <span className="reservation-detail-label">Secondary Email</span>{reservation.secondaryEmail}
                                                        </div>
                                                    )}
                                                    <div className="reservation-detail-item">
                                                        <span className="reservation-detail-label">Phone</span>{reservation.phone}
                                                    </div>
                                                    <div className="reservation-detail-item">
                                                        <span className="reservation-detail-label">People</span>{reservation.numberOfPeople}
                                                    </div>
                                                    <div className="reservation-detail-item" style={{gridColumn: '1 / -1'}}>
                                                        <span className="reservation-detail-label">Purpose</span>{reservation.purpose}
                                                    </div>
                                                    {reservation.notes && (
                                                        <div className="reservation-detail-item" style={{gridColumn: '1 / -1'}}>
                                                            <span className="reservation-detail-label">Notes</span>{reservation.notes}
                                                        </div>
                                                    )}
                                                </div>
                                                <div className="reservation-actions">
                                                    {reservation.status === 'pending' && (
                                                        <>
                                                            <button className="btn btn-success" onClick={() => approveReservation(reservation.id)}>
                                                                âœ“ Approve
                                                            </button>
                                                            <button className="btn btn-danger" onClick={() => denyReservation(reservation.id)}>
                                                                âœ— Deny
                                                            </button>
                                                        </>
                                                    )}
                                                    <button className="btn btn-secondary" onClick={() => editReservation(reservation)}>âœï¸ Edit</button>
                                                    <button className="btn btn-secondary" onClick={() => {
                                                        if (confirm('Choose calendar format:\n\nOK = Download .ics file (Outlook Desktop, Apple Calendar)\nCancel = See more options')) {
                                                            downloadOutlookCalendar(reservation);
                                                        } else {
                                                            const choice = prompt('Enter number:\n1 = Download .ics file\n2 = Open in Outlook.com\n3 = Open in Google Calendar', '1');
                                                            if (choice === '1') downloadOutlookCalendar(reservation);
                                                            else if (choice === '2') openOutlookWeb(reservation);
                                                            else if (choice === '3') openGoogleCalendar(reservation);
                                                        }
                                                    }}>ðŸ“… Calendar</button>
                                                    <button className="btn btn-danger" onClick={() => deleteReservation(reservation.id)}>ðŸ—‘ï¸ Delete</button>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        </>
                    )}

                    {showModal && (
                        <div className="modal" onClick={() => setShowModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h2>{editingReservation ? 'Edit Reservation' : 'Complete Your Reservation'}</h2>
                                    <button className="close-btn" onClick={() => setShowModal(false)}>Ã—</button>
                                </div>

                                <form onSubmit={handleSubmit}>
                                    <div className="form-grid">
                                        <div className="form-group">
                                            <label>First Name *</label>
                                            <input type="text" name="firstName" value={formData.firstName} onChange={handleFormChange} required />
                                        </div>
                                        <div className="form-group">
                                            <label>Last Name *</label>
                                            <input type="text" name="lastName" value={formData.lastName} onChange={handleFormChange} required />
                                        </div>
                                    </div>

                                    <div className="form-grid">
                                        <div className="form-group">
                                            <label>Email *</label>
                                            <input type="email" name="email" value={formData.email} onChange={handleFormChange} required />
                                        </div>
                                        <div className="form-group">
                                            <label>Secondary Email (Optional)</label>
                                            <input type="email" name="secondaryEmail" value={formData.secondaryEmail} onChange={handleFormChange} />
                                        </div>
                                    </div>

                                    <div className="form-grid">
                                        <div className="form-group">
                                            <label>Phone *</label>
                                            <input type="tel" name="phone" value={formData.phone} onChange={handleFormChange} required />
                                        </div>
                                        <div className="form-group">
                                            <label>Number of People *</label>
                                            <input type="number" name="numberOfPeople" value={formData.numberOfPeople} 
                                                onChange={handleFormChange} min="1" max="500" required />
                                        </div>
                                    </div>

                                    <div className="form-group">
                                        <label>School Reserving *</label>
                                        <select name="school" value={formData.school} onChange={handleFormChange} required>
                                            <option value="">Select a school</option>
                                            {SCHOOLS.map(school => <option key={school} value={school}>{school}</option>)}
                                        </select>
                                    </div>

                                    <div className="form-group">
                                        <label>Purpose of Visit *</label>
                                        <input type="text" name="purpose" value={formData.purpose} onChange={handleFormChange}
                                            placeholder="e.g., Field trip, Class visit, Workshop" required />
                                    </div>

                                    <div className="form-group">
                                        <label>Additional Notes</label>
                                        <textarea name="notes" value={formData.notes} onChange={handleFormChange} rows="4"
                                            placeholder="Any special requirements or notes..." />
                                    </div>

                                    <div style={{marginTop: '20px', padding: '15px', background: 'rgba(44, 95, 45, 0.05)', borderRadius: '8px'}}>
                                        <strong>Reservation Summary:</strong>
                                        <div style={{marginTop: '10px'}}>
                                            <div>ðŸ“ Location(s): {selectedLocations.map(l => l.name).join(', ')}</div>
                                            <div>ðŸ“… Date: {selectedDate && formatDate(selectedDate)}</div>
                                            <div>ðŸ• Start Time: {selectedTimeSlot}</div>
                                            <div>ðŸ• End Time: {selectedEndTime}</div>
                                            <div>â±ï¸ Duration: {formatDuration(calculateDuration(selectedTimeSlot, selectedEndTime))}</div>
                                            {selectedLocations.length > 1 && (
                                                <div style={{marginTop: '10px', fontWeight: 'bold', color: 'var(--primary)'}}>
                                                    This will create {selectedLocations.length} separate reservations
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    <button type="submit" className="btn btn-primary"
                                        style={{width: '100%', marginTop: '20px', padding: '16px', fontSize: '1.1em'}}>
                                        {editingReservation ? 'Update Reservation' : 'Complete Reservation'}
                                    </button>
                                </form>
                            </div>
                        </div>
                    )}
                </>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ReservationCalendar />);
    </script>
</body>
</html>
